<!DOCTYPE html>
<html>
  <head>
    <meta charset='utf-8'>
    <meta http-equiv="X-UA-Compatible" content="chrome=1">
    <link href='https://fonts.googleapis.com/css?family=Chivo:900' rel='stylesheet' type='text/css'>
    <link rel="stylesheet" type="text/css" href="stylesheets/stylesheet.css" media="screen" />
    <link rel="stylesheet" type="text/css" href="stylesheets/pygment_trac.css" media="screen" />
    <link rel="stylesheet" type="text/css" href="stylesheets/print.css" media="print" />
    <!--[if lt IE 9]>
    <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
    <title>Arduino-Wireless-Power-Meter by andrewmh20</title>
  </head>

  <body>
    <div id="container">
      <div class="inner">

        <header>
  <h1>Arduino-Wireless-Power-Meter</h1>
        <h2>Modified Kill-a-Watt based on  <a href="http://www.ladyada.net/make/tweetawatt/index.html">Lady Ada's Tweet-a-Watt</a> with the addition of an Arduino Ethernet.</h2>        </header>

        <section id="downloads" class="clearfix">
          <a href="https://github.com/andrewmh20/Arduino-Wireless-Power-Meter/zipball/master" id="download-zip" class="button"><span>Download .zip</span></a>
          <a href="https://github.com/andrewmh20/Arduino-Wireless-Power-Meter/tarball/master" id="download-tar-gz" class="button"><span>Download .tar.gz</span></a>
          <a href="https://github.com/andrewmh20/Arduino-Wireless-Power-Meter" id="view-on-github" class="button"><span>View on GitHub</span></a>
        </section>

        <hr>

        <section id="main_content">
     
		<img src="images/Arduino_Wireless_Power_Meter.png">
        
		<h3>Hardware:</h3>
<p>To set up the Xbee and Kill-a-Watt connection, I followed the instructions 
	by Lady Ada exactly, using the kit from Adafruit.com, except that instead of using analog inputs 0 and 4 on the transmitter, I used A0 and A1. However, because of the close proximity of the resistors going into one hole, I used A4, but then routed it to A1 using a jumper wire underneath. Also, on the receiver, I used vertical male headers, and only connected them to the pins I needed to connect to the Arduino, in order to make it easier to use female-to-male jumper wires for the connection. </p>
  <p>  To connect to the Arduino I hooked up the ground and 5V pins from the Xbee
breakout board to the Arduino, and hooked up TX to a Software Serial pin (I used A0 because of physical location).</p>
<p> Download my Bill of Materials from here: <a href="Bill of Materials.xlsx">Bill of Materials</a>.<br>
All the documentation and instructions for the original Tweet-a-Watt project can be found <a href="http://www.ladyada.net/make/tweetawatt/make.html">here</a>.</p>
<h3>Python Script Modification:</h3>
<p>Before moving on to the Arduino part of my project I wanted to test the direct Xbee connection to the computer with Lady Ada's python scripts. After downloading Lady Ada's python scripts I found that it was rather difficult to get the Twitter libraries installed on Windows.
	In order to fix that problem, since I was not concerned with tweeting in my project I just deleted all the lines referencing that library.</p>
<h3>Arduino Software:</h3>
<p>I wrote code for the Arduino to receive data over Xbee, parse it, convert it to actual volts and amps, average it, and send it over Ethernet 
	to a server. I used the website Cosm.com, formerly Pachube.com, which, with the help of some of the Arduino
	example code, graphs the real time and historical data online.</p> 
<p>For the serial parser functions, the original python code was very helpful, as was the online manual to the Xbee (<a href="http://ftp1.digi.com/support/documentation/90000982_B.pdf">Xbee Manual</a>), but when it came to actually calculating the voltage, current, and power from the raw ADC data, I used  my own methods. It should be noted that the Xbee only sends data for the inputs that are active. So in this case, no digital data was sent, only 2 analog channels. </p>
<p>The ADC data coming from the Xbee are 10 bit numbers between 0 and 1024, where ideally 512 is equivalent to 0 volts/amps, but that is not always the case. After receiving the data and isolating the ADC values, which are what we care about, they need to be converted to volts and amps. To do so for both volts and amps, I first calculated the digital number which would correspond to zero, and subtracted that from each sample. Then using trial and error, I found a constant which I divided each value by (different for volts and amps). Then I used those samples to calculate the RMS voltage and current. To calculate apparent power I multiplied them, and to calculate real power, I multiplied each individual sample, and took the mean of that. I calculated a moving average for each of those to smooth out the data.
</p>
<p>Lastly, the Arduino sends strings to Cosm.com which include a PUT request header, and the actual data in .csv format.</p>
<p> The real time graphs can be viewed at <a href="https://cosm.com/feeds/68173">https://cosm.com/feeds/68173</a>. To view the most recent data please refresh the web page.
</p>
<h3>For the future:</h3>
<p>In the future I plan to add support for multiple transmitters, try to make the data more accurate, calculate the checksum of the Xbee data, and also to write a program to download historical data from Cosm.com.</p>

<h3>Credits:</h3>

<p>I used the Arduino Ethernet, SPI, Software Serial, avr, and avr/wdt libraries. The hardware is based on the Tweet-a-Watt kit from <a href="adafruit.com">adafruit.com</a>. The code is  based on Lady Ada's python script but with some important modifications as explained above.</p>



<h3>Contact:</h3>

<p>Feel free to contact me with any questions about the project and its setup or license by email at <a href="mailto:andrewmh20@nyc.rr.com">andrewmh20@nyc.rr.com</a>!<br>
Videos and blog posts for the project can be found at the <a href=" http://www.bluestampengineering.com/author/andrewmh12/">Blue Stamp Engineering Website.</a>
</p>
        </section>
<footer>
      Arduino-Wireless-Power-Meter is maintained by <a href="https://github.com/andrewmh20">andrewmh20</a><br>
	  Bitcoin Donations: 1KqZFbM7AuKay7qSeV1beRtgQXDif3GmEM <br>  
      This page was generated by <a href="http://pages.github.com">GitHub Pages</a> and <a href="https://github.com/andrewmh20">Andrew Merczynski-Hait</a>. Tactile theme by <a href="http://twitter.com/jasonlong">Jason Long</a>.
            
      <a rel="license" href="http://creativecommons.org/licenses/by-nc-sa/3.0/"><img alt="Creative Commons License" style="border-width:0" src="http://i.creativecommons.org/l/by-nc-sa/3.0/88x31.png" /></a><br />
      <span xmlns:dct="http://purl.org/dc/terms/" property="dct:title">Arduino Wireless Power Meter</span> by <a xmlns:cc="http://creativecommons.org/ns#" href="mailto:andrewmh20@nyc.rr.com" property="cc:attributionName" rel="cc:attributionURL">Andrew Merczynski-Hait</a> is licensed under a <a rel="license" href="http://creativecommons.org/licenses/by-nc-sa/3.0/">Creative Commons Attribution-NonCommercial-ShareAlike 3.0 Unported License</a>.<br />Based on a project at <a xmlns:dct="http://purl.org/dc/terms/" href="http://www.ladyada.net/make/tweetawatt/index.html" rel="dct:source">http://www.ladyada.net/make/tweetawatt/index.html</a>.
          <br>
		  <!-- Counter Code START --><a href="http://www.e-zeeinternet.com/" target="_blank"><img src="http://www.e-zeeinternet.com/count.php?page=872990&style=default&nbdigits=3" alt="HTML Hit Counter" border="0" ></a><br><a href="http://www.e-zeeinternet.com/" title="HTML Hit Counter" target="_blank" style="font-family: Geneva, Arial, Helvetica, sans-serif; font-size: 10px; color: #000000; text-decoration: none;">HTML Hit Counter</a><!-- Counter Code END -->  
        </footer>
      </div>
    </div>
  </body>
</html>