<!DOCTYPE html>
<html>
  <head>
    <meta charset='utf-8'>
    <meta http-equiv="X-UA-Compatible" content="chrome=1">
    <link href='https://fonts.googleapis.com/css?family=Chivo:900' rel='stylesheet' type='text/css'>
    <link rel="stylesheet" type="text/css" href="stylesheets/stylesheet.css" media="screen" />
    <link rel="stylesheet" type="text/css" href="stylesheets/pygment_trac.css" media="screen" />
    <link rel="stylesheet" type="text/css" href="stylesheets/print.css" media="print" />
    <!--[if lt IE 9]>
    <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
    <title>Tweet-a-watt-arduino by andrewmh20</title>
  </head>

  <body>
    <div id="container">
      <div class="inner">

        <header>
  <h1>Tweet-a-Watt with Arduino Modifications</h1>
        <h2>Modified Kill-a-Watt based on Lady Ada's instructions http://www.ladyada.net/make/tweetawatt/index.html with the addition of an Arduino Ethernet</h2>        </header>

        <section id="downloads" class="clearfix">
          <a href="https://github.com/andrewmh20/Tweet-a-Watt-Arduino/zipball/master" id="download-zip" class="button"><span>Download .zip</span></a>
          <a href="https://github.com/andrewmh20/Tweet-a-Watt-Arduino/tarball/master" id="download-tar-gz" class="button"><span>Download .tar.gz</span></a>
          <a href="https://github.com/andrewmh20/Tweet-a-Watt-Arduino" id="view-on-github" class="button"><span>View on GitHub</span></a>
        </section>

        <hr>

        <section id="main_content">
     
		
		<h3>Hardware:</h3>
<p>To set up the Xbee and Kill-a-Watt connection, I followed the instructions 
	by Lady Ada exactly (<a href="http://www.ladyada.net/make/tweetawatt/make.html">Make the hardware</a>), using the kit from Adafruit.com, except that instead of using analog inputs 0 and 4 on the transmitter, I used A0 and A1. However, because of the close proximity of the resistors going into one hole, I used A4, but then routed it to A1 using a jumper wire underneath. Also, on the receiver, I used vertical male headers, and only connected them to the pins I needed to connect to the Arduino, in order to make it easier to use female-to-male jumper wires for the connection. </p>
  <p>  To connect to the Arduino I hooked up the ground and 5V pins from the Xbee
breakout board to the Arduino, and hooked up TX to a Software Serial pin (I used A0 because of physical location).</p>
<h3>Python Script Modification:</h3>
<p>After downloading Lady Ada's python scripts I found that it was rather difficult to get the Twitter libraries installed on Windows.
	In order to fix that problem, since I was not concerned with tweeting in my project I just deleted all the lines referencing that library.</p>
<h3>Arduino Software:</h3>
<p>I wrote code for the Arduino to receive data over Xbee, parse it, average it, and send it over Ethernet 
	to a server. I used the website Cosm.com, formerly Pachube.com which, with the help of some of the Arduino
	example code, graphs the real time and historical data online.</p> 
<p>For the serial parser functions, the python code was very helpful, as was the online manual to the Xbee (<a href="http://ftp1.digi.com/support/documentation/90000982_B.pdf">Xbee Manual</a>), but when it came to actually calculating the voltage, current, and power from the raw ADC data, I used  my own methods. It should be noted that the Xbee only sends data for the inputs that are active. So in this case, no digital data was sent, only 2 analog channels. </p>
<p>The ADC data coming from the Xbee are 10 bit numbers between 0 and 1024, where ideally 512 is equivalent to 0 volts/amps, but that is not always the case. After receiving the data and isolating the ADC values, which are what we care about, they need to be converted to volts and amps. To do so for both volts and amps, I first calculated the digital number which would correspond to zero, and subtracted that from each sample. Then using trial and error, I found a constant which I divided each value by (different for volts and amps). Then I used those samples to calculate the RMS voltage and current. To calculate apparent power I multiplied them, and to calculate real power, I multiplied each individual sample, and took the mean of that. I calculated a moving average for each of those to smooth out the data.
</p>
<p>Lastly, the Arduino sends strings to Cosm.com which include a PUT request header, and the actual data in .csv format.</p>
<h3> Here are the real time graphs:</h3>
<p> They can also be viewed at <a href="https://cosm.com/feeds/68173">https://cosm.com/feeds/68173</a>. To view the most recent data please refresh the web page. 
</p>
<img src="https://api.cosm.com/v2/feeds/68173/datastreams/CurrentRMS.png?width=730&height=250&colour=%23f15a24&duration=5minutes&show_axis_labels=true&detailed_grid=true&timezone=Eastern%20Time%20(US%20%26%20Canada)">

<h3>External Sources:</h3>

<p>I used the Arduino Ethernet, SPI, Software Serial, avr, and avr/wdt libraries. The code is  based on Lady Ada's python script but with some important modifications as explained above.</p>

<h3>Contact:</h3>

<p>Feel free to contact me with any questions about the project and its setup by email at <a href="mailto:andrewmh20@nyc.rr.com">andrewmh20@nyc.rr.com</a>!</p>
        </section>

        <footer>
          Tweet-a-watt-arduino is maintained by <a href="https://github.com/andrewmh20">andrewmh20</a><br>
          This page was generated by <a href="http://pages.github.com">GitHub Pages</a>and Andrew Merczynski-Hait. Tactile theme by <a href="http://twitter.com/jasonlong">Jason Long</a>.
        </footer>

        
      </div>
    </div>
  </body>
</html>